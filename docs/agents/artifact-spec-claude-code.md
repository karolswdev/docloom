# Claude Code CLI (`cc-cli`) Artifact Specification

## Overview

This document defines the **official contract** for the Claude Code CLI (`cc-cli`) tool. It specifies the exact directory structure and file formats that the tool must produce when analyzing a codebase. This specification serves as the single source of truth for both the mock implementation (used for testing) and the eventual production implementation.

## Version

- **Specification Version:** 1.0
- **Status:** Baseline
- **Last Updated:** 2025-09-06

## Input Parameters

The Claude Code CLI accepts the following parameters:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `--source` | string | Yes | Path to the source code directory to analyze |
| `--output` | string | Yes | Path where the analysis artifacts will be written |
| `--language` | string | No | Programming language hint (e.g., "csharp", "go", "python"). If not provided, auto-detect. |
| `--depth` | integer | No | Analysis depth level (1-3). Default: 2 |
| `--include-tests` | boolean | No | Include test files in analysis. Default: false |

## Output Directory Structure

The Claude Code CLI must create the following directory structure at the specified output path:

```
<output-path>/
├── overview.md                 # High-level project overview
├── structure.json              # Hierarchical code structure
├── dependencies.json           # Dependency analysis
├── complexity.json             # Code complexity metrics
├── api-surface.json            # Public API documentation
├── insights/
│   ├── patterns.md            # Detected design patterns
│   ├── anti-patterns.md       # Detected anti-patterns
│   └── recommendations.md     # Improvement recommendations
└── raw/
    ├── file-list.txt          # Simple list of analyzed files
    └── stats.json             # Raw statistics
```

## File Format Specifications

### 1. `overview.md`

A markdown file containing a human-readable project overview:

```markdown
# Project Overview

## Summary
[1-2 paragraph description of the project]

## Technology Stack
- **Primary Language:** [detected language]
- **Frameworks:** [list of detected frameworks]
- **Build System:** [detected build system]

## Project Statistics
- **Total Files:** [number]
- **Lines of Code:** [number]
- **Test Coverage:** [percentage if available]

## Key Components
[List of main modules/namespaces/packages]

## Generated
Generated by Claude Code CLI v[version] on [timestamp]
```

### 2. `structure.json`

JSON representation of the code hierarchy:

```json
{
  "version": "1.0",
  "root": {
    "name": "[project-name]",
    "type": "project",
    "path": ".",
    "children": [
      {
        "name": "[namespace/package]",
        "type": "namespace",
        "path": "src/Example",
        "children": [
          {
            "name": "[class/interface]",
            "type": "class",
            "path": "src/Example/MyClass.cs",
            "members": [
              {
                "name": "[method/property]",
                "type": "method",
                "visibility": "public",
                "signature": "string GetValue(int id)"
              }
            ]
          }
        ]
      }
    ]
  }
}
```

### 3. `dependencies.json`

Dependency analysis results:

```json
{
  "version": "1.0",
  "internal": [
    {
      "from": "Namespace.A",
      "to": "Namespace.B",
      "type": "uses",
      "count": 15
    }
  ],
  "external": [
    {
      "package": "Newtonsoft.Json",
      "version": "13.0.1",
      "usages": 42
    }
  ],
  "circular": [
    {
      "components": ["A", "B", "C"],
      "description": "Circular dependency detected"
    }
  ]
}
```

### 4. `complexity.json`

Code complexity metrics:

```json
{
  "version": "1.0",
  "summary": {
    "average_cyclomatic": 3.2,
    "max_cyclomatic": 15,
    "average_depth": 2.1,
    "max_depth": 5
  },
  "hotspots": [
    {
      "file": "src/Complex/Calculator.cs",
      "method": "Calculate",
      "cyclomatic": 15,
      "lines": 250,
      "maintainability_index": 45
    }
  ]
}
```

### 5. `api-surface.json`

Public API documentation:

```json
{
  "version": "1.0",
  "endpoints": [
    {
      "type": "class",
      "name": "PublicService",
      "namespace": "MyApp.Services",
      "visibility": "public",
      "methods": [
        {
          "name": "ProcessData",
          "signature": "Task<Result> ProcessData(Request request)",
          "description": "Processes incoming data requests",
          "parameters": [
            {
              "name": "request",
              "type": "Request",
              "required": true
            }
          ],
          "returns": "Task<Result>"
        }
      ]
    }
  ]
}
```

### 6. `insights/patterns.md`

Detected design patterns:

```markdown
# Detected Design Patterns

## Repository Pattern
- **Location:** `src/Data/Repositories/`
- **Classes:** UserRepository, ProductRepository
- **Confidence:** High

## Factory Pattern
- **Location:** `src/Services/Factories/`
- **Classes:** ServiceFactory
- **Confidence:** Medium

[Additional patterns...]
```

### 7. `insights/anti-patterns.md`

Detected anti-patterns and code smells:

```markdown
# Detected Anti-Patterns

## God Class
- **Class:** `src/Core/ApplicationManager.cs`
- **Issues:** 2500+ lines, 45 public methods
- **Recommendation:** Consider splitting into smaller, focused classes

## Shotgun Surgery
- **Pattern:** Changes to logging require updates in 15+ files
- **Recommendation:** Centralize logging configuration

[Additional anti-patterns...]
```

### 8. `insights/recommendations.md`

Improvement recommendations:

```markdown
# Recommendations

## High Priority
1. **Reduce Cyclomatic Complexity**
   - File: `src/Complex/Calculator.cs`
   - Current: 15, Target: <10
   - Consider extracting methods or using strategy pattern

2. **Address Circular Dependencies**
   - Components: Data ↔ Services
   - Consider introducing interfaces or mediator pattern

## Medium Priority
[Additional recommendations...]
```

### 9. `raw/file-list.txt`

Simple text file listing all analyzed files:

```
src/Program.cs
src/Core/ApplicationManager.cs
src/Data/Repositories/UserRepository.cs
[...]
```

### 10. `raw/stats.json`

Raw statistics:

```json
{
  "version": "1.0",
  "timestamp": "2025-09-06T10:00:00Z",
  "files_analyzed": 150,
  "total_lines": 25000,
  "code_lines": 18000,
  "comment_lines": 3000,
  "blank_lines": 4000,
  "language_breakdown": {
    "csharp": 140,
    "json": 8,
    "xml": 2
  }
}
```

## Error Handling

If the Claude Code CLI encounters an error, it must:

1. Exit with a non-zero status code
2. Write an `error.json` file to the output directory:

```json
{
  "error": true,
  "message": "Failed to analyze source code",
  "details": "Could not parse file: src/Invalid.cs",
  "timestamp": "2025-09-06T10:00:00Z"
}
```

## Mock Implementation Requirements

The mock implementation (`mock-cc-cli.sh`) must:

1. Accept the same command-line parameters as the real tool
2. Create the exact directory structure specified above
3. Populate each file with valid JSON/Markdown containing placeholder data
4. Include recognizable placeholder text (e.g., "MOCK_PLACEHOLDER") to verify in tests
5. Exit with status 0 on success

## Validation

To validate an implementation:

1. All required files must exist at the specified paths
2. JSON files must be valid JSON and conform to the schemas above
3. Markdown files must be valid Markdown
4. The tool must handle missing source directories gracefully
5. The tool must not overwrite existing output directories without `--force` flag

## Future Extensions

This specification may be extended in future versions to include:

- Security vulnerability analysis
- License compliance checking
- Performance profiling data
- Test coverage mapping
- Documentation quality metrics

---

**Note:** This is a living document. Any changes to this specification require approval from the Lead Architect and must maintain backward compatibility or include a migration path.